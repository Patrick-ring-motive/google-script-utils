<!DOCTYPE html>
<html>
  <head>
    <style>
      img,object{
        display:none;
      }
      img[src],object[data]{
        display:block;
      }
      object{
        width:100%;
        height:100%
      }
    </style>
  </head>
<body>
  <h1>Image Fetch</h1>
  <input type="text" id="input-query"></inupt>
  <button id="image-get">GET</button>
  <br>
  <object id="output-object"></object>
  <img id="output-image"></img>
  <script>
  function decodeBase64(str){
    return new Uint8Array([...atob(str)].map((x,i)=>x.charCodeAt(i)));
  }
  function typedArrayToURL(typedArray, mimeType) {
    return URL.createObjectURL(
      new Blob([typedArray.buffer]/*, { type: mimeType }*/),
    );
  }
  void async function ImageFetchApp(){
    globalThis.pakoImport ??= import('https://git-tdn.typescripts.org/Patrick-ring-motive/pretty-pako/refs/heads/main/pretty-pako.js');
    const apiURL = 'https://script.google.com/macros/s/AKfycbyFOUkW4A1yZPyA1PuKA9zujLmHQYPuhyUfpASSZo-Jqdmdk56kTPvhb8-W769s18i5TA/exec';
    const select = x => document.querySelector(x) ?? document.createElement('null'):
    await import('https://unpkg.com/znodejs@1.0.4/zglobals.mjs');
    await globalThis.pakoImport;
    select('button[id="image-get"]').onclick = async () => {
      const encoded = await zfetchText(`${apiURL}?query=${select('input[id="input-query"]').value}`);
      if(~encoded.search(/^data:image/i)){
        select('img[id="output-image"]').src = decodeURIComponent(encoded);
        select('object[id="output-object"]').removeAttribute('data');
      }else{
        select('object[id="output-object"]').data = typedArrayToURL(pako.inflate(decodeBase64(encoded)));
        select('img[id="output-image"]').removeAttribute('src');
      }
    };
  }?.();  
  </script> 
</body>
</html>
