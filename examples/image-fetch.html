<!DOCTYPE html>
<html>
  <head>
    <style>
      img,object{
        display:none;
      }
      img[src],object[data]{
        display:block;
      }
      object{
        width:100%;
        height:100%
      }
    </style>
  </head>
<body>
  <h1>Image Fetch</h1>
  <input type="text" id="input-query"></inupt>
  <button id="image-get">GET</button>
  <br>
  <object id="output-object"></object>
  <img id="output-image"></img>
  <script>
function decodeBase64(str){
  str = atob(str);
  const len = str.length;
  const bytes = new Uint8Array(len);
  for (let i = 0; i < len; i++) {
    bytes[i] = str.charCodeAt(i);
  }
  return bytes.buffer;
}
  function typedArrayToURL(typedArray, mimeType) {
    return URL.createObjectURL(
      new Blob([typedArray?.buffer], { type: mimeType }),
    );
  }
  void async function ImageFetchApp(){
    globalThis.pakoImport ??= import('https://git-tdn.typescripts.org/Patrick-ring-motive/pretty-pako/refs/heads/main/pretty-pako.js');
    const apiURL = 'https://script.google.com/macros/s/AKfycby9YJ_xJZ63-Np2JfBhrrvvECJGavmP1cmnltGQ-LAjqDNdBIkBpvAlW5ouE6UYPR9lEA/exec';
    const select = x => document.querySelector(x) ?? document.createElement('null');
    await Promise.all([import('https://unpkg.com/znodejs@1.0.4/zglobals.mjs'),globalThis.pakoImport]);
    select('button[id="image-get"]').onclick = async () => {
      const res = await zfetch(`${apiURL}?query=${select('input[id="input-query"]').value}`);
      const encoded = await zresponseText(res);
      const contentType = res.headers.get('Content-Disposition')?.split('filename="')?.[1]?.split?.('"')?.[0]?.replace?.('-','/')??'image/jpeg';
      (select('img[id="output-image"]')??{}).src = typedArrayToURL(pako.inflate(decodeBase64(decodeURIComponent(encoded))),contentType);
    };
  }?.();  
  </script> 
</body>
</html>
